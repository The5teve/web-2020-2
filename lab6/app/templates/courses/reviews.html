{% extends 'base.html' %}
{% from 'pagination.html' import render_pagination %}
{% block content %}
<div class="text-center pt-5 d-flex" >
    <div class="m-auto">
        <h1 class="title mb-3 font-weight-bold">{{ course.name }}</h1>
        <p class="mb-3 mx-auto">
            {{ course.category.name }} | <span>★</span> <span>{{ "%.2f" | format(course.rating) }}</span>
        </p>
        <div class="container">
            <p class="description w-75 mb-5 mx-auto">
                Отзывы
            </p>
        </div>
    </div>
</div>
<div class="my-2">
    <div class="container">
    <h2 class="mb-3 text-center text-uppercase font-weight-bold">Сортировка</h2>

    <form class="mb-5 mt-3 row align-items-center">      
        <div class="col-md-10 my-3">
            <input hidden value="{{course.id}}" name="course_id" >
            <select class="form-control selectpicker" data-live-search="true" id="sort" name="sort" title="Выбрать фильтр">
                <option value="created_at" {% if 'created_at' in request.args.getlist('sort') %} selected {% elif not request.args.getlist('sort') %} selected{% endif %}>По новизне</option>
                <option value="rating_asc" {% if 'rating_asc' in request.args.getlist('sort') %}selected{% endif %}>Сначала отрицательные</option>
                <option value="rating_desc" {% if 'rating_desc' in request.args.getlist('sort') %}selected{% endif %}>Сначала положительные</option>
            </select>
        </div>

        <div class="col-md-2 my-3 align-self-end">
            <button type="submit" class="btn btn-primary w-100 mt-auto">Найти</button>
        </div>
    </form>
</div>
</div>


<div class="container">

    {% if current_user.is_authenticated %}
    {% if not own_review %}
    <form class="w-100" method="POST" action="{{ url_for('courses.reviews', course_id=course.id) }}">
        <h3>Оставить комментарий</h3>
        <div class="form-group">
            <textarea class="form-control" name="text"  cols="20" rows="3"></textarea>
        </div>
        <input type="hidden" name="user_id" value="{{ current_user.id }}">
        <input type="hidden" name="course_id" value="{{ course_id }}">
        <div class="form-group">
            <label for="exampleFormControlSelect1">Оценка курса</label>
            <select class="form-control" id="exampleFormControlSelect1" name="rating">
              <option selected value="5">Отлично</option>
              <option value="4">Хорошо</option>
              <option value="3">Удовлетворительно</option>
              <option value="2"> Неудовлетворительно</option>
              <option value="1">Плохо</option>
              <option value="0">Ужасно</option>
            </select>
          </div>
        <div class="form-group text-right">
            <input class="btn btn-primary" type="submit" value="Оставить комментарий">
        </div>
    
    </form> 

{% else %}
<div class='border border-success rounded p-2 my-2'>
    <h3> Ваш комментарий </h3>
    <div class="media my-4">

        <a class="pull-left ml-5" href="#"><img class="img-fluid rounded-circle cursor-pointer comments ml-5" style="width: 60%;"
            src="{{ url_for('static', filename='images/default-profile-picture-300x300.jpeg') }}" alt="profile-pic"> </a>
        <div class="media-body my-auto">
            <h4 class="media-heading">{{own_review.user.full_name}} </h4>
            <ul class="list-unstyled list-inline media-detail pull-right">
                <h6 class="">
                    {% for i in range(0,own_review.rating)%}
                    <span>★</span>
                    {% endfor %}
                    {% for i in range(0,5-own_review.rating)%}
                    <span>☆</span>   
                    {% endfor %}
                    <span > {{own_review.rating}}/5 </span>
                </h6>
            </ul>
            <p>{{own_review.text}}</p>
            <ul class="list-unstyled list-inline media-detail pull-left">
                <li></i>{{own_review.created_at}}</li>
            </ul>

        </div>
    </div>
</div>
{% endif%}
{% endif %}
        {% for rev in reviews %}
        <div class="media my-4">
            <a class="pull-left ml-5" href="#"><img class="img-fluid rounded-circle cursor-pointer comments ml-5" style="width: 60%;"
                src="{{ url_for('static', filename='images/default-profile-picture-300x300.jpeg') }}" alt="profile-pic"> </a>
            <div class="media-body my-auto">
                <h4 class="media-heading">{{rev.user.full_name}} </h4>
                <ul class="list-unstyled list-inline media-detail pull-right">
                    <h6 class="">
                        {% for i in range(0,rev.rating)%}
                        <span>★</span>
                        {% endfor %}
                        {% for i in range(0,5-rev.rating)%}
                        <span>☆</span>
                        {% endfor %}
                        <span > {{rev.rating}}/5 </span>   
                    </h6>
                </ul>
                <p>{{rev.text}}</p>
                <ul class="list-unstyled list-inline media-detail pull-left">
                    <li></i>{{rev.created_at}}</li>
                </ul>
        
            </div>
        </div>
        {% endfor %}
</table>

{{ render_pagination(pagination, request.endpoint, search_params) }}
</div>
{% endblock %}
